<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>adc_recursion_stack.pks</title><link rel="stylesheet" type="text/css" href="../../../styles/main.css" /><script type="text/javascript" src="../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="ADC_RECURSION_STACK"></a><a name="Topic99"></a><div class="CTopic TClass LSQL first">
 <div class="CTitle">ADC_RECURSION_STACK</div>
 <div class="CBody"><p>This package separates the maintenance of the recursive stack from the core functionality.&nbsp; It is accessible by <a href="../../../index.html#File:core/packages/adc_internal.pks:ADC_INTERNAL" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,587);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >ADC_INTERNAL</a> only.</p><p>A recursion stack is used to control recursive rule execution in that the list of firing items for which the rules have to be evaluated is collected.&nbsp; It's a FIFO stack of unique items whith a recursive depth indicator.&nbsp; If a page item on the stack has been processed, it is popped from the stack.</p><p>Items are pushed onto the stack only if</p><ul><li><p>the max recusrive depth is not yet reached (to prevent endless loops)</p></li><li><p>the rule and the actually executed action allows for recursion</p></li><li><p>the item to push is referenced in a technical rule condition of the actual rule group (If this condition is not met, it is clear that pusing this item onto the recursive stack will lead to a no rule result, wasting resources)</p></li><li><p>the item was not pushed onto the recursion stack during the actual call before, prventing unnecessary double rule evaluation</p></li></ul><p>The recursion stack also maintains a list of all &quot;touched&quot; items, meaning all items which have been on the recursive stack during the actual rule evaluation.&nbsp; This allows to monitor that no item is pushed onto the recursive stack twice.&nbsp; It it also used to remove any error message from the APEX page for these items.&nbsp; The error messages may be attached again based on the response, but by using this mechanism, it is possible to remove only those errors for which rules have been processed.</p><div class="CHeading">Author</div><p>Juergen Sieben, ConDeS GmbH</p></div>
</div>

<a name="ADC_RECURSION_STACK.Public_methods"></a><a name="Topic377"></a><div class="CTopic TGroup LSQL">
 <div class="CTitle">Public methods</div>
</div>

<a name="ADC_RECURSION_STACK.reset"></a><a name="Topic156"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">reset</div>
 <div id="NDPrototype156" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> reset(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_cgr_id&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> adc_rule_groups.cgr_id<span class="SHKeyword">%type</span>,</td></tr><tr><td class="PName first">p_cpi_id&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> adc_page_items.cpi_id<span class="SHKeyword">%type</span></td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Method to reset the recursion stack.</p><p>This method performs the following tasks:</p><ul><li><p>reset the recursion stack</p></li><li><p>detect whether the selected rule group supports recursion or not</p></li><li><p>put the initial firing item onto the recursion stack.</p></li></ul><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_cgr_id<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_rule_groups.cgr_id<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>ID of the rule group. Is used to check whether recursion is allowed for this rule group</p></td></tr><tr><td class="CDLEntry">p_cpi_id<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_page_items.cpi_id<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>ID of the page item to push. May also be <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.C_NO_FIRING_ITEM" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,270);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.C_NO_FIRING_ITEM</a></p></td></tr></table></div>
</div>

<a name="ADC_RECURSION_STACK.push_firing_item"></a><a name="Topic157"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">push_firing_item</div>
 <div id="NDPrototype157" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> push_firing_item(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_cgr_id&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> adc_rule_groups.cgr_id<span class="SHKeyword">%type</span>,</td><td></td><td class="last"></td></tr><tr><td class="PName first">p_cpi_id&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> adc_page_items.cpi_id<span class="SHKeyword">%type</span>,</td><td></td><td class="last"></td></tr><tr><td class="PName first">p_allow_recursion&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.flag_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,262);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.flag_type</a></td><td class="PDefaultValueSeparator">&nbsp;<span class="SHKeyword">default</span>&nbsp;</td><td class="PDefaultValue last">adc_util.C_TRUE,</td></tr><tr><td class="PName first">p_force&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.flag_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,262);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.flag_type</a></td><td class="PDefaultValueSeparator">&nbsp;<span class="SHKeyword">default</span>&nbsp;</td><td class="PDefaultValue last">adc_util.C_FALSE</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Method to register a firing item onto the recursion stack.</p><p>If the actually selected action type does not allow for recursion, it will not be pushed, resulting in no recursive rule evaluation</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_cgr_id<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_rule_groups.cgr_id<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>ID of the rule group.</p></td></tr><tr><td class="CDLEntry">p_cpi_id<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_page_items.cpi_id<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>ID of the page item to push. May also be C_NO_FIRING_ITEM</p></td></tr><tr><td class="CDLEntry">p_allow_recursion<div class="CDLParameterType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.flag_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,262);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.flag_type</a></div></td><td class="CDLDefinition"><p>Flag to indicate whether recursion is forbidden for that action type.&nbsp; Value can be overwritten by g_param.allow_recursion, so if the rule is set to not evaluate recursion, this will be respected.</p></td></tr><tr><td class="CDLEntry">p_force<div class="CDLParameterType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.flag_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,262);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.flag_type</a></div></td><td class="CDLDefinition"><p>Flag to indicate whether this item should be pushed anyway to the recursive stack.&nbsp; Set to C_TRUE on page initialization to assure that all firing items are on the recursive stack.</p></td></tr></table></div>
</div>

<a name="ADC_RECURSION_STACK.pop_firing_item"></a><a name="Topic159"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">pop_firing_item</div>
 <div id="NDPrototype159" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> pop_firing_item(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_cpi_id&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> adc_page_items.cpi_id<span class="SHKeyword">%type</span>,</td><td></td><td class="last"></td></tr><tr><td class="PName first">p_all&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.flag_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,262);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.flag_type</a></td><td class="PDefaultValueSeparator">&nbsp;<span class="SHKeyword">default</span>&nbsp;</td><td class="PDefaultValue last">adc_util.C_FALSE</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Method to pop one or all items from the recursive stack.</p><p>Normal use case is to pop the actual firing item after it has been succesfully evaluated.&nbsp; If the rule execution signals a STOP_RULE, all recursive items are removed from the stack</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_cpi_id<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_page_items.cpi_id<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>ID of the page item to pop. May also be C_NO_FIRING_ITEM</p></td></tr><tr><td class="CDLEntry">p_all<div class="CDLParameterType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.flag_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,262);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.flag_type</a></div></td><td class="CDLDefinition"><p>Flag to indicate whether all items should be popped (adc_util.C_TRUE) or not (adc_util.C_FALSE)</p></td></tr></table></div>
</div>

<a name="ADC_RECURSION_STACK.get_next"></a><a name="Topic381"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">get_next</div>
 <div id="NDPrototype381" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">function</span> get_next</div><div class="PSection PPlainSection"><span class="SHKeyword">return</span> adc_page_items.cpi_id<span class="SHKeyword">%type</span></div></div>
 <div class="CBody"><p>Method to retrieve the name of the first entry of the recursion stack.</p><div class="CHeading">Returns</div><p>Name of the first entry of the recursion stack</p></div>
</div>

<a name="ADC_RECURSION_STACK.get_level"></a><a name="Topic382"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">get_level</div>
 <div id="NDPrototype382" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">function</span> get_level</div><div class="PSection PPlainSection"><span class="SHKeyword">return</span> pls_integer</div></div>
 <div class="CBody"><p>Method to retrieve the actual recursion level for notification purposes.</p></div>
</div>

<a name="ADC_RECURSION_STACK.get_firing_items_as_json"></a><a name="Topic383"></a><div class="CTopic TFunction LSQL last">
 <div class="CTitle">get_firing_items_as_json</div>
 <div id="NDPrototype383" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">function</span> get_firing_items_as_json</div><div class="PSection PPlainSection"><span class="SHKeyword">return</span> <span class="SHKeyword">varchar2</span></div></div>
 <div class="CBody"><p>Method get all firing items back in&nbsp; JSON</p><pre>[{<span class="SHString">&quot;id&quot;</span>:<span class="SHString">&quot;#ID#&quot;</span>,<span class="SHString">&quot;value&quot;</span>:<span class="SHString">&quot;#VALUE#&quot;</span>},..]</pre><p>Is used to collect all firing items in JSON to send it back to the client</p><div class="CHeading">Returns</div><p>JSON string containing the JSON representation of the CHAR_TABLE</p></div>
</div>

</body></html>