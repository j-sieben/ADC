<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>adc_response.pks</title><link rel="stylesheet" type="text/css" href="../../../styles/main.css" /><script type="text/javascript" src="../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="ADC_RESPONSE"></a><a name="Topic539"></a><div class="CTopic TClass LSQL first">
 <div class="CTitle">ADC_RESPONSE</div>
 <div class="CBody"><p>Implements the logic to collect and format the JavaScript response a call to ADC creates.</p><p>ADC creates a response script that controls the visual effects of the rule execution client side.&nbsp; To achive that, the response is created as a script html element containing a JavaScript code to change the visual state with the following format:</p><pre>&lt;script id=<span class="SHString">&quot;S_{random id}&quot;</span>&gt;<br />  <span class="SHComment">// Total duration: {duration in hsec}</span><br />  de.condes.plugin.adc.setItemValues([{<span class="SHString">&quot;id&quot;</span>:<span class="SHString">&quot;Item Name&quot;</span>,<span class="SHString">&quot;value&quot;</span>:<span class="SHString">&quot;Item Value&quot;</span>},{...}]);  <span class="SHComment">// List of items changed during the rule evaluation at the database</span><br />  de.condes.plugin.adc.setErrors({<br />    <span class="SHString">&quot;count&quot;</span>:<span class="SHNumber">0</span>, <span class="SHComment">// error counter of this evaluation</span><br />    <span class="SHString">&quot;firingItems&quot;</span>:[<span class="SHString">&quot;Item Names&quot;</span>], <span class="SHComment">// list of &quot;touched&quot; items, i.e. items for which rules have been evaluated. Used to remoce their assigned errors on the page</span><br />    <span class="SHString">&quot;errors&quot;</span>:[]}); <span class="SHComment">// List of APEX error instances to display on the page</span><br /><br />  <span class="SHComment">// During installation, creation of apex.actions instances and their wiring to page items is added</span><br /><br />  <span class="SHComment">// Recursion 1: Rule {sort sequence} ({Name of the rule}), Firing Item: &quot;{Name of the firing item}&quot;, Duration: {Evaluation time of the rule in hsec}</span><br />  {JavaScript code}<br />&lt;/script&gt;</pre><p>The script element is identified by an id attribute. This allows the client side ADC functionality to remove the script element after appending it to the DOM tree. Appending the element to the tree executes the contained JavaScript. As the JavaScript answer is executed only once in response to the request to the ADC, it may savely be deleted after execution of the script.</p><p>The content of the script partly depends on the phase the page is in. During initialization, more information is contained, such as metadata for apex actions which have to be added to the page and other information.</p><p>During dynamic response to page events, only the information necessary to change the visual state or the behaviour of the page are sent.</p><div class="CHeading">Author</div><p>Juergen Sieben, ConDeS GmbH</p></div>
</div>

<a name="ADC_RESPONSE.Functions"></a><a name="Topic600"></a><div class="CTopic TGroup LSQL">
 <div class="CTitle">Functions</div>
</div>

<a name="ADC_RESPONSE.add_error"></a><a name="Topic550"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">add_error</div>
 <div id="NDPrototype550" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> add_error(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_error&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> apex_error.t_error</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Pushes an APEX error instance onto an internal error stack.&nbsp; All errors are integrated into the response when retrieving the JavaScript answer.</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_error<div class="CDLParameterType"><span class="SHKeyword">in</span> apex_error.t_error</div></td><td class="CDLDefinition"><p>Instance of the error in format &lt;apex_error.t_error&gt;.</p></td></tr></table></div>
</div>

<a name="ADC_RESPONSE.add_javascript"></a><a name="Topic588"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">add_javascript</div>
 <div id="NDPrototype588" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> add_javascript(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_java_script&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> <span class="SHKeyword">varchar2</span>,</td><td></td><td class="last"></td></tr><tr><td class="PName first">p_debug_level&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> <span class="SHKeyword">binary_integer</span></td><td class="PDefaultValueSeparator">&nbsp;<span class="SHKeyword">default</span>&nbsp;</td><td class="PDefaultValue last">adc_util.C_JS_CODE</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Method to add a JavaScript code snippet to the response.</p><p>May be used to add comments as well. Make sure to reduce p_debug_level in this case to allow for conditional display of the comment based on their severity.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_java_script<div class="CDLParameterType"><span class="SHKeyword">in</span> <span class="SHKeyword">varchar2</span></div></td><td class="CDLDefinition"><p>JavaScript code.</p></td></tr><tr><td class="CDLEntry">p_debug_level<div class="CDLParameterType"><span class="SHKeyword">in</span> <span class="SHKeyword">binary_integer</span></div></td><td class="CDLDefinition"><p>Level of the JavaScript code. Only a subset of the <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,256);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util</a> constants are allowed: <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.C_JS_CODE" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,272);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.C_JS_CODE</a>, <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.C_JS_RULE_ORIGIN" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,273);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.C_JS_RULE_ORIGIN</a>, <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.C_JS_DEBUG" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,274);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.C_JS_DEBUG</a>, <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.C_JS_COMMENT" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,275);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.C_JS_COMMENT</a> and <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.C_JS_DETAIL" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,276);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.C_JS_DETAIL</a>.&nbsp; If the level is not <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.C_JS_CODE" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,272);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.C_JS_CODE</a>, the JavaScript is treated as a comment (commented out).</p></td></tr></table></div>
</div>

<a name="ADC_RESPONSE.add_comment"></a><a name="Topic603"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">add_comment</div>
 <div id="NDPrototype603" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> add_comment(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_message_name&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> <span class="SHKeyword">varchar2</span>,</td><td></td><td class="last"></td></tr><tr><td class="PName first">p_msg_args&nbsp;</td><td class="PType"><span class="SHKeyword">in</span> msg_args</td><td class="PDefaultValueSeparator">&nbsp;<span class="SHKeyword">default</span>&nbsp;</td><td class="PDefaultValue last"><span class="SHKeyword">null</span></td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Adds a comment to the JavaScript answer if applicable. Is used to append comments about the inner workings to the JavaScript answer. Whether a message is added depends on the severity of the message and debug level.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_message_name<div class="CDLParameterType"><span class="SHKeyword">in</span> <span class="SHKeyword">varchar2</span></div></td><td class="CDLDefinition"><p>Name of the Message</p></td></tr><tr><td class="CDLEntry">p_msg_args<div class="CDLParameterType"><span class="SHKeyword">in</span> msg_args</div></td><td class="CDLDefinition"><p>Optional argument object</p></td></tr></table></div>
</div>

<a name="ADC_RESPONSE.get_response"></a><a name="Topic581"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">get_response</div>
 <div id="NDPrototype581" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">function</span> get_response</div><div class="PSection PPlainSection"><span class="SHKeyword">return</span> <span class="SHKeyword">varchar2</span></div></div>
 <div class="CBody"><p>Method to compose the JavaScript result of the rule evaluation</p><p>Depending on parameterization and length of the response, the response will contain more or lesse code.&nbsp; As the maximum response size is limited to 32KByte, the method may decide to skip comments in order to respect the size limit.</p><p>Calling this method also terminates and resets the internal response structures.</p><div class="CHeading">Returns</div><p>JavaScript code to execute in response to the rule evaluation request.</p></div>
</div>

<a name="ADC_RESPONSE.initialize_response"></a><a name="Topic582"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">initialize_response</div>
 <div id="NDPrototype582" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> initialize_response(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_initialize_mode&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> <span class="SHKeyword">boolean</span>,</td></tr><tr><td class="PName first">p_cgr_id&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> adc_rule_groups.cgr_id<span class="SHKeyword">%type</span></td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Method to initialize the ADC response before evaluating the rule set.</p><p>If p_initialize_mode is set, this method also adds instantiation code to the response, such as apex.action code should apex actions exist for the rule group.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_initialize_mode<div class="CDLParameterType"><span class="SHKeyword">in</span> <span class="SHKeyword">boolean</span></div></td><td class="CDLDefinition"><p>Flag to indicate whether the page initializes.</p></td></tr><tr><td class="CDLEntry">p_cgr_id<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_rule_groups.cgr_id<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>ID of the rule group to evaluate. Is used to create the initialization JavaScript code.</p></td></tr></table></div>
</div>

<a name="ADC_RESPONSE.register_recursion_end"></a><a name="Topic591"></a><div class="CTopic TFunction LSQL">
 <div class="CTitle">register_recursion_end</div>
 <div id="NDPrototype591" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> register_recursion_end(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_rule_found&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> <span class="SHKeyword">boolean</span></td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Method finalizes the response of the actual recursive rule evaluation.</p><p>Main task is to add timing information.</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_rule_found<div class="CDLParameterType"><span class="SHKeyword">in</span> <span class="SHKeyword">boolean</span></div></td><td class="CDLDefinition"><p>Flag to indicate whether a rule has been found for this request</p></td></tr></table></div>
</div>

<a name="ADC_RESPONSE.register_recursion_start"></a><a name="Topic592"></a><div class="CTopic TFunction LSQL last">
 <div class="CTitle">register_recursion_start</div>
 <div id="NDPrototype592" class="NDPrototype WideForm"><div class="PSection PParameterSection PascalStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">procedure</span> register_recursion_start(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first">p_origin_message&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.ora_name_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,259);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.ora_name_type</a>,</td></tr><tr><td class="PName first">p_run_count&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> <span class="SHKeyword">binary_integer</span>,</td></tr><tr><td class="PName first">p_cru_sort_seq&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> adc_rules.cru_sort_seq<span class="SHKeyword">%type</span>,</td></tr><tr><td class="PName first">p_cru_name&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> adc_rules.cru_name<span class="SHKeyword">%type</span>,</td></tr><tr><td class="PName first">p_firing_item&nbsp;</td><td class="PType last"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.ora_name_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,259);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.ora_name_type</a></td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Method initializes the response of the actual recursive rule evaluation.</p><p>It also adds a comment to the JavaScript stack to indicate the rule details the script originates from and other useful information such as the recursive depth and so forth.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">p_origin_message<div class="CDLParameterType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.ora_name_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,259);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.ora_name_type</a></div></td><td class="CDLDefinition"><p>Dependent on the environment, different origins are possible. This parameter contains the message to use</p></td></tr><tr><td class="CDLEntry">p_run_count<div class="CDLParameterType"><span class="SHKeyword">in</span> <span class="SHKeyword">binary_integer</span></div></td><td class="CDLDefinition"><p>Counter that indicates how often the decision table was queried.&nbsp; ADC suppresses repeated execution of a rule, so if this number is relatively high, this may be an indicator for unnecessary rules or badly written technical conditions.</p></td></tr><tr><td class="CDLEntry">p_cru_sort_seq<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_rules.cru_sort_seq<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>Sort sequence of the rule. Used to identify the rule evaluated</p></td></tr><tr><td class="CDLEntry">p_cru_name<div class="CDLParameterType"><span class="SHKeyword">in</span> adc_rules.cru_name<span class="SHKeyword">%type</span></div></td><td class="CDLDefinition"><p>Name of the rule. Used to identify the rule evaluated</p></td></tr><tr><td class="CDLEntry">p_firing_item<div class="CDLParameterType"><span class="SHKeyword">in</span> <a href="../../../index.html#File:core/packages/adc_util.pks:ADC_UTIL.ora_name_type" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,259);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >adc_util.ora_name_type</a></div></td><td class="CDLDefinition"><p>Item that caused the rule to be evaluated</p></td></tr></table></div>
</div>

</body></html>